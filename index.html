<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <style type="text/css">
    body {
      padding-top: 70px;
      padding-bottom: 30px;
    }
    .dl-horizontal dt {
      width: 200px;
    }
    .dl-horizontal dd {
      margin-left: 210px;
    }
  </style>
  <script src="//maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>

</head>

<body onload="initialize()">
  <!-- Fixed navbar -->
  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Airup</a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="/index.html">Home</a>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Platser <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="/index.html?lat=59.312963&lon=18.080363">Sofo</a>
              </li>
              <li><a href="/index.html?lat=59.315782&lon=18.033371">Hornstull</a>
              </li>
              <li><a href="/index.html?lat=59.324723&lon=18.069806">Gamla stan</a>
              </li>
              <li><a href="/index.html?lat=40.668090&lon=-73.980732">Park Slope</a>
              </li>
              <li><a href="/index.html?lat=37.800294&lon=-122.439601">Marina District(SF)</a>
              </li>
              <li><a href="/index.html?lat=52.536958&lon=13.408041">Prenzlauer Berg, Berlin</a>
              </li>
              <li><a href="/index.html?lat=51.532071&lon=-0.060360">London Shoreditch</a>
              </li>
              <li><a href="/index.html?lat=-23.560057&lon=-46.634334">Liberdade Sao Paulo</a>
              </li>
              <li><a href="/index.html?lat=57.70887&lon=11.97456">Gullbergsvass</a>
              </li>
              <li><a href="/index.html?lat=59.31472280000001&lon=18.02025470000001">Färgfabriken</a>
              </li>
              <li><a href="/index.html?lat=63.827743&lon=20.256825">Centrala stan (Umeå)</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </div>



  <div class="container theme-showcase" role="main">



    <div class="page-header">
      <h1>Locations</h1>

    </div>
    <div class="row">
      <div class="col-sm-12">

        <div class="form-group">
          <label for="autocomplete">Search for an address</label>
          <div id="locationField">
            <input id="autocomplete" placeholder="Enter your address" onFocus="geolocate()" type="text" class="form-control"></input>
          </div>
        </div>

      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <form class="form-inline well">

          <div class="form-group">
            <label for="lat">Latitude</label>
            <input type="text" class="form-control lat" id="lat" name="lat" value="-23.560057">
          </div>

          <div class="form-group">
            <label for="lon">Longitude</label>
            <input type="text" class="form-control lon" id="lon" name="lon" value="-46.634334">
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>

      </div>
    </div>


    <div class="row">
      <div class="col-sm-8">
        <h2 id="myhood"></h2>
        <dl class="dl-horizontal" id="location"></dl>
      </div>
      <div class="col-sm-4">
        <a href="" class="btn btn-default pull-right" id="mapUrl" target="_blank" style="display:none"> <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> MAP</a>
      </div>
    </div>



    <div class="row">
      <div class="col-sm-12">
        <div class="alert alert-success" id="status" style="display:none"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-4">
        <h3>Submit data</h3>
        <form method="post" action="/submitToQueue" id="submit-data-form" class="well">
          <div class="form-group">
            <label for="pm10">pm10</label>
            <input type="text" class="form-control" id="pm10" name="pm10" placeholder="0.0">
          </div>
          <div class="form-group">
            <label for="pm25">pm25</label>
            <input type="text" class="form-control" id="pm25" name="pm25" placeholder="0.0">
          </div>
          <div class="form-group">
            <label for="o3">o3</label>
            <input type="text" class="form-control" id="o3" name="o3" placeholder="0.0">
          </div>
          <div class="form-group">
            <label for="no2">no2 (ppm)</label>
            <input type="text" class="form-control" id="no2" name="no2" placeholder="0.0">
          </div>
          <div class="form-group">
            <label for="co">co (ppm)</label>
            <input type="text" class="form-control" id="co" name="co" placeholder="0.0">
          </div>

          <div class="form-group">
            <label for="lat">Latitude</label>
            <input type="text" class="form-control lat" id="lat" name="lat" value="-23.560057">
          </div>
          <div class="form-group">
            <label for="lon">Longitude</label>
            <input type="text" class="form-control lon" id="lon" name="lon" value="-46.634334">
          </div>
          <div class="form-group">
            <label for="sourceId">sourceId</label>
            <input type="text" class="form-control" id="sourceId" name="sourceId" value="ABC123">
          </div>

          <button type="submit" class="btn btn-primary">Submit</button>

        </form>
      </div>
    </div>



    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <script>
      // This example displays an address form, using the autocomplete feature
      // of the Google Places API to help users fill in the information.

      var placeSearch, autocomplete;
      var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
      };


      function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }



      function initialize() {
        // Create the autocomplete object, restricting the search
        // to geographical location types.
        autocomplete = new google.maps.places.Autocomplete(
          /** @type {HTMLInputElement} */
          (document.getElementById('autocomplete')), {
            types: ['geocode']
          });
        // When the user selects an address from the dropdown,
        // populate the address fields in the form.
        google.maps.event.addListener(autocomplete, 'place_changed', function() {
          fillInAddress();
        });
      }

      // [START region_fillform]
      function fillInAddress() {
          // Get the place details from the autocomplete object.
          var place = autocomplete.getPlace();
          console.log("place", place);
          $("#mapUrl").attr("href", place.url).show();
          var lat = place.geometry.location.A;
          var lng = place.geometry.location.F;
          getGeoCode(lat, lng);

        }
        // [END region_fillform]

      // [START region_geolocation]
      // Bias the autocomplete object to the user's geographical location,
      // as supplied by the browser's 'navigator.geolocation' object.
      function geolocate() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var geolocation = new google.maps.LatLng(
                position.coords.latitude, position.coords.longitude);
              var circle = new google.maps.Circle({
                center: geolocation,
                radius: position.coords.accuracy
              });
              autocomplete.setBounds(circle.getBounds());
            });
          }
        }
        // [END region_geolocation]

      function getGeoCode(lat, lng) {

        $("#location").html("");

        $("input.lon").val(lng);
        $("input.lat").val(lat);
        $("#mapUrl").attr("href", "http://maps.google.com/maps?q=" + lat + "," + lng).show();

        $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat + "," + lng + "&sensor=true").done(function(data) {

          $("#status").html("Geocode retrieve status: <strong>" + data.status + "<strong>").show();

          for (var i in data.results) {
            var val = data.results[i];
            $("#location").append('<dt>' + val.address_components[0].types[0] + '</dt><dd>' + val.formatted_address + '</dd>');
          }

          for (var i in data.results) {
            var val = data.results[i];
            if (val.address_components[0].types[0] === "neighborhood") {
              $("#myhood").html("I live in <code>" + val.address_components[0].long_name + "</code>");
              return;
            }
            else if (val.address_components[0].types[0] === "sublocality") {
              $("#myhood").html("I live in <code>" + val.address_components[0].long_name + "</code>");
              return;
            }
            else if (val.address_components[0].types[0] === "sublocality_level_2") {
              $("#myhood").html("I live in <code>" + val.address_components[0].long_name + "</code>");
              return;
            }
            else if (val.address_components[0].types[0] === "sublocality_level_1") {
              $("#myhood").html("I live in <code>" + val.address_components[0].long_name + "</code>");
              return;
            }
            else if (val.address_components[0].types[0] === "administrative_area_level_4") {
              $("#myhood").html("I live in <code>" + val.address_components[0].long_name + "</code>");
              return;
            }
            else if (val.address_components[0].types[0] === "administrative_area_level_3") {
              $("#myhood").html("I live in <code>" + val.address_components[0].long_name + "</code>");
              return;
            }

            if ($("#myhood").html() == "") {
              $("#myhood").html("<code>Unknown location</code>");
            }

          }
          //var location = data.results[0].address_components[2].short_name;
          //var locationDetailed = data.results[0].address_components[1].short_name + " " + data.results[0].address_components[0].short_name;
        });


      }

      var urlLat = getParameterByName("lat");
      var urlLon = getParameterByName("lon");
      if (urlLat != "" && urlLon != "") {
        getGeoCode(urlLat, urlLon);
      }
    </script>

  </div>
</body>

</html>
